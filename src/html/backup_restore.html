<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup & Restore - Extension Data</title>
    <link rel="stylesheet" href="../css/backup_restore.css">
    <link rel="stylesheet" href="../../public/fonts/fonts.css">
</head>
<body>
    <div class="page-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../public/icons/png/modcore-em.png" alt="Extension Logo" class="header-logo no-mask">
                <h1 class="sidebar-title">Extension Backup</h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><button class="sidebar-button active" data-panel="backup-restore"><span class="icon icon-shield"></span> Backup & Restore</button></li>
                    <li><button class="sidebar-button" data-panel="data-management"><span class="icon icon-id"></span> Data Management</button></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <p>&copy; 2025 modcore</p>
            </div>
        </aside>

        <main class="content-area">
            <div id="backup-restore-panel" class="content-panel" role="tabpanel" aria-labelledby="backup-restore-tab" tabindex="0">
                <div class="panel-header">
                    <h2>Backup & Restore Extension Data</h2>
                    <p>Manage the extension's data by creating encrypted backups or restoring from a previous backup file.</p>
                </div>
                <div class="panel-content">
                    <section class="content-section" id="create-backup-section">
                        <h3 class="section-title">Create Backup</h3>
                        <div class="details-grid">
                            <div class="detail-item detail-item-full-width">
                                <label for="backupFileName" class="detail-label">File Name</label>
                                <input type="text" id="backupFileName" class="text-input" placeholder="e.g., extension_backup_2025-08-09">
                            </div>
                            <div class="detail-item detail-item-full-width">
                                <p class="detail-label">Select Data to Include</p>
                                <div class="checkbox-group">
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="backupChromeLocal" value="chromeLocal" checked>
                                        <span class="checkmark"></span> Chrome Local Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="backupChromeSync" value="chromeSync" checked>
                                        <span class="checkmark"></span> Chrome Sync Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="backupWebLocal" value="webLocal" checked>
                                        <span class="checkmark"></span> Web Local Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="backupWebSession" value="webSession" checked>
                                        <span class="checkmark"></span> Web Session Storage
                                    </label>
                                </div>
                            </div>
                            <div class="detail-item detail-item-full-width">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="enableEncryptionCheckbox">
                                    <span class="checkmark"></span>
                                    Encrypt Backup with Password
                                    <span class="tooltip-trigger" style="margin-left: var(--spacing-small);"><span class="icon icon-help"></span><span class="tooltip-content">Adds an extra layer of security to your backup file by encrypting its contents with a password. This is highly recommended for sensitive data.</span></span>
                                </label>
                            </div>
                        </div>

                        <div id="encryptionPasswordFields" class="details-grid" hidden>
                            <div class="detail-item">
                                <label for="backupPassword" class="detail-label">Encryption Password</label>
                                <input type="password" id="backupPassword" class="text-input" placeholder="Enter a strong password">
                            </div>
                            <div class="detail-item">
                                <label for="confirmBackupPassword" class="detail-label">Confirm Password</label>
                                <input type="password" id="confirmBackupPassword" class="text-input" placeholder="Re-enter password">
                            </div>
                            <div class="detail-item detail-item-full-width" id="password-strength-container" hidden>
                                <label class="detail-label">Password Strength</label>
                                <div class="password-strength-meter">
                                    <progress id="passwordStrengthBar" value="0" max="100"></progress>
                                    <span id="passwordStrengthText" class="strength-text"></span>
                                </div>
                            </div>
                        </div>

                        <div class="details-actions-grid" style="margin-top: var(--spacing-large);">
                            <button id="createBackupBtn" class="btn primary">
                                <span class="icon icon-download"></span> Create Backup
                            </button>
                        </div>
                    </section>
                    
                    <section class="content-section" id="restore-backup-section">
                        <h3 class="section-title">Restore Backup</h3>
                        <div class="details-grid">
                            <div class="detail-item detail-item-full-width">
                                <label for="restoreFile" class="detail-label">Select Backup File</label>
                                <div class="file-upload-container">
                                    <input type="file" id="restoreFile" class="file-input" accept=".json">
                                    <label for="restoreFile" class="file-input-label btn secondary">
                                        <span class="icon icon-upload"></span> Choose File
                                    </label>
                                    <span id="selectedFileName" class="file-name-display">No file chosen</span>
                                </div>
                            </div>
                            <div id="restorePasswordInputGroup" class="detail-item detail-item-full-width" hidden>
                                <label for="restorePassword" class="detail-label">Encryption Password</label>
                                <input type="password" id="restorePassword" class="text-input" placeholder="Password for encrypted backup">
                            </div>
                            <div class="detail-item detail-item-full-width" id="restore-options-container" hidden>
                                <p class="detail-label">Select Data to Restore</p>
                                <div class="checkbox-group">
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="restoreChromeLocal" value="chromeLocal">
                                        <span class="checkmark"></span> Restore Chrome Local Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="restoreChromeSync" value="chromeSync">
                                        <span class="checkmark"></span> Restore Chrome Sync Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="restoreWebLocal" value="webLocal">
                                        <span class="checkmark"></span> Restore Web Local Storage
                                    </label>
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="restoreWebSession" value="webSession">
                                        <span class="checkmark"></span> Restore Web Session Storage
                                    </label>
                                </div>
                                <div class="metadata-display" id="backup-metadata"></div>
                            </div>
                        </div>
                        <div class="details-actions-grid" style="margin-top: var(--spacing-large);">
                            <button id="restoreBackupBtn" class="btn primary" disabled>
                                <span class="icon icon-upload"></span> Restore Backup
                            </button>
                        </div>
                    </section>
                </div>
                <div class="api-error-display" id="backupRestoreError">
                    <span class="icon icon-error"></span>
                    <p class="error-message"></p>
                </div>
            </div>

            <div id="data-management-panel" class="content-panel" role="tabpanel" aria-labelledby="data-management-tab" tabindex="0" hidden>
                <div class="panel-header">
                    <h2>Data Management</h2>
                    <p>View the data stored by the extension and selectively clear it from different storage types.</p>
                </div>
                <div class="panel-content">
                    <section class="content-section">
                        <h3 class="section-title">View Stored Data</h3>
                        <p class="detail-description-text">Below is the data currently stored by the extension across different storage areas.</p>
                        <div class="details-actions-grid" style="margin-bottom: var(--spacing-medium);">
                            <input type="text" id="dataSearchInput" class="text-input" placeholder="Search keys or values...">
                             <button id="downloadLoadedDataBtn" class="btn secondary">
                                <span class="icon icon-download"></span> Download
                            </button>
                        </div>
                        <div id="data-view-container">
                            <div id="stored-data-display" class="code-block" style="display: block;">
                                <pre><code>No data loaded yet. Click 'Load Data' to view.</code></pre>
                                <button class="btn-icon btn-copy" title="Copy to Clipboard"><span class="icon icon-copy"></span></button>
                            </div>
                        </div>
                        <div class="details-actions-grid" style="margin-top: var(--spacing-large);">
                             <button id="loadDataBtn" class="btn secondary">
                                <span class="icon icon-list"></span> Load Data
                            </button>
                        </div>
                    </section>

                    <section class="content-section" id="clear-data-section">
                        <h3 class="section-title">Clear Data by Storage Type</h3>
                        <p class="detail-description-text">Select which storage types you want to clear. This action cannot be undone for the selected storage areas.</p>
                        <div class="checkbox-group" style="margin-bottom: var(--spacing-large);">
                            <label class="checkbox-container">
                                <input type="checkbox" id="clearChromeLocal" value="chromeLocal">
                                <span class="checkmark"></span>
                                Chrome Local Storage (<code class="storage-size" data-storage="chromeLocal">...</code>)
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="clearChromeSync" value="chromeSync">
                                <span class="checkmark"></span>
                                Chrome Sync Storage (<code class="storage-size" data-storage="chromeSync">...</code>)
                                <span class="tooltip-trigger" style="margin-left: var(--spacing-small);"><span class="icon icon-help"></span><span class="tooltip-content">All data in Cloud Sync will be permanently deleted. If you’ve uploaded local data, checking this will remove it from the cloud. Deleting local data as well will make recovery impossible.</span></span>
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="clearWebLocal" value="webLocal">
                                <span class="checkmark"></span>
                                Web Local Storage (<code class="storage-size" data-storage="webLocal">...</code>)
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="clearWebSession" value="webSession">
                                <span class="checkmark"></span>
                                Web Session Storage (<code class="storage-size" data-storage="webSession">...</code>)
                                <span class="tooltip-trigger" style="margin-left: var(--spacing-small);"><span class="icon icon-help"></span><span class="tooltip-content">This option may be empty because it’s not used by modcore Extension Manager. Deleting data here should have no effect.</span></span>
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="clearChromeManaged" value="chromeManaged" disabled>
                                <span class="checkmark"></span>
                                Chrome Managed Storage (Read-only)
                                <span class="tooltip-trigger" style="margin-left: var(--spacing-small);"><span class="icon icon-help"></span><span class="tooltip-content">Managed storage cannot be cleared by the extension.</span></span>
                            </label>
                        </div>
                        <div class="details-actions-grid">
                            <button id="clearSelectedDataBtn" class="btn danger">
                                <span class="icon icon-trash"></span> Clear Selected Data
                            </button>
                        </div>
                    </section>
                </div>
                <div class="api-error-display" id="dataManagementError">
                    <span class="icon icon-error"></span>
                    <p class="error-message"></p>
                </div>
            </div>

            <div class="loading-overlay" id="loading-overlay" hidden>
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>
        </main>
    </div>

    <div id="toast-container"></div>

    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal-content">
            <h3 id="modal-title">Confirm Action</h3>
            <p id="modal-message">Are you sure you want to proceed with this action?</p>
            <div class="modal-actions">
                <button class="btn secondary" id="modal-cancel">Cancel</button>
                <button class="btn danger" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script src="../js/backup_restore.js"></script>
    <script src="../js/profile-cards.js"></script>
</body>
</html>
